
// 1. Load Sentinel-2 SR Data

var sen = ee.ImageCollection("COPERNICUS/S2_SR_HARMONIZED")
  .filterDate('2023-04-01', '2023-11-30')
  .filter(ee.Filter.lt('CLOUDY_PIXEL_PERCENTAGE', 10))
  .filterBounds(roi)
  .select(['B4', 'B8']); // Red & NIR

print('Sentinel-2 Collection:', sen);


// 2. Compute NDSI = (Red - NIR) / (Red + NIR)

var addNDSI = function(img) {
  var ndsi = img.normalizedDifference(['B4', 'B8']).rename('NDSI');
  return img.addBands(ndsi);
};

var senNDSI = sen.map(addNDSI);

// Take the median image for visualization
var ndsiMedian = senNDSI.select('NDSI').median();


// 3. Compute Max and Min NDSI Values

var ndsiMax = ndsiMedian.reduceRegion({
  reducer: ee.Reducer.max(),
  geometry: roi,
  scale: 10,
  bestEffort: true
});

var ndsiMin = ndsiMedian.reduceRegion({
  reducer: ee.Reducer.min(),
  geometry: roi,
  scale: 10,
  bestEffort: true
});

print('NDSI MAX value:', ndsiMax);
print('NDSI MIN value:', ndsiMin);


// 4. Visualize NDSI on Map

var ndsiVis = {
  min: -1,
  max: 1,
  palette: ['blue', 'white', 'red']
};


// 5. EXPORT NDSI AS GEOTIFF

Export.image.toDrive({
  image: ndsiMedian,
  description: 'NDSI_Median_2023',
  folder: 'Nyran Works',   // change if you want
  fileNamePrefix: 'NDSI_Median_2023',
  region: roi,
  scale: 10,
  maxPixels: 1e13
})

Map.centerObject(roi, 10);
Map.addLayer(ndsiMedian, ndsiVis, 'NDSI (Salinity Index)');
